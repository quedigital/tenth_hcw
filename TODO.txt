

// TODO: hide controls for "text" layouts

// TODO: on desktop: images can be zoomed on desktop (mousewheel? double-click?)

// TODO: search pane (hideable?) used for other spreads to jump to
// TODO: keywords (searchable) for spreads

// TODO: hard-code callout line directions in editor? [3_2]

// TODO: flowchart spread

// TODO: remove embedded "line-height" tags from the text
// TODO: convert things like [dg] in the text

// TODO: on small screens: fixed layout zooms in just enough for text to fit in its boundary?

// TODO: animate callout lines (grid and fixed)

// TODO: triggering steps and callouts needs to keep up with scrolling better and maybe only show one callout line at a time
			(with focus highlight on current step)
// TODO: waypoint triggering is still a little wonky
			
// TODO: eliminate memory leaks

// TODO: slide show layout?

// TODO: during infinite scroll, remove past spreads from memory

// TODO: change URL location to reflect current spread? (history.pushState)

// TODO: fun entry / surprise page ("How does your phone know...?")

// TODO: layouts don't seem to be full-screen on iOS Safari

// TODO: spread count (by chapter?)

// TODO: find a better way to handle video sizing (ie, not knowing the size right away)

// TODO: marginTop not working? [not being used]

// UI DESIGN: retina images?  (Cloudinary can downsample for us: http://res.cloudinary.com/hcw10/image/upload/w_0.5/v1406726724/10_1/image1.png)
//            or you can set a pixel ratio in Cloudinary or use their plugin and .cloudinary_update();
// UI DESIGN: or use SVG for most non-raster images? (IE9+)
// CODE DESIGN: decide whether to load from json or from processed HTML/Javascript

// DONE: add a handle for the resizable
// DONE: view one spread at a time, selectable from list
// DONE: don't hard-code variable "cm"
// DONE: only show placement checkboxes for cells that have an associated image
// DONE: save the new width to the database
// DONE: add checkboxes for image position
// DONE: trigger cell resize when width is updated (ala checkbox subscribe method)
// DONE: set image placement checkboxes on load
// DONE: what if content and layout indices don't line up sometimes? [switched to id's]
// DONE: steps nicely set off in panels or wells
// DONE: textarea sized to fit
// DONE: custom fields for grid or fixed layouts (using knockout if binding)
// DONE: variable properties nicely formatted in a grid or table
// DONE: navbar for spread and layout info
// DONE: put "grid / fixed" field in content or layout – NOT BOTH
// BUG_FIXED: "grid / fixed" select keeps resetting, upon page reload, to the first option?! (first on the content side, now on the layout side... strange!) [valueAllowUnset seemed to do the trick]
// DONE: image placement as a 9-box selectable grid widget
// TODONT: move all image references to layout (nah)
// IGNORE: getVariableProperties doesn't work when updating values (yes, I think it does; well, not now it doesn't; obviated)
// DONE: ability to add extra properties [generic "styling" text area]
// DONE: fixed layout anchor point UI [in properties table]
// DONE: handle glossary terms (ie, bold) within text
// DONE: add class name to callouts [theme field]
// DONE: "glossary" style button
// DONE: show currently selected spread
// DONE: sidebar add and delete spreads
// DONE: rename editor.js spread instance to something like Editor
// DONE: ability to add step
// DONE: put marginLeft (for grid layout) into the property panel
// DONE: standardize anchor values
// DONE: make sure new cell id's are unique (using max id + 1)
// DONE: when adding/deleting cells, sync layout hints
// DONE: re-order cells
// DONE: when updating hint id's via textbox, update the necessary data("id") as well
// DONE: update sidebar list when a spread gets deleted (and added and modified)
// DONE: also add/delete corresponding layout when spread gets added/deleted
// DONE: export to json (server side process that will let us download the json output -- not necessary!)
// DONE: backup and undo capability
// DONE: use human-readable cell names
// DONE: load published pages from json
// DONE: make callouts open with mouse over (desktop)
// DONE: animate fading away of expanded box on Fixed Layout
// DONE: tap doesn't show highlight on fixed layout (iPad)
// DONE: remove 300ms click delay (iPad) –> use touchend not click
// DONE: tap to toggle highlights (iPad)
// DONE: image uploading (Firebase server?) with resizing? [using Cloudinary]
// DONE: fix https/http warning between Cloudinary and Firebase
// DONE: refactor the callouts so the same one is used for fixed and grid layouts?
// DONE: make the "player" show the new-style grid layouts correctly
// DONE: sort spread list by chapter and number
// DONE: refactor the grid layout code so it's in one place (a new Common directory?) [somewhat: common/js/Helpers.js for findSpace, reserveSpace]
// DONE: layouts for cells with images should have position checkboxes
// DONE: load json from Cloudinary
// DONE: "interactive" cell type
// DONE: "publish spread" checkbox
// DONE: video widget
// DONE: background color for each spread
// DONE: find a way to make Amazon AWS bucket items public via Javascript
// TODONT: export json to Cloudinary [used Amazon via Google instead]
// DONE: layout.notes (for ToDo's, etc.)
// DONE: make publish order match editor order
// DONE: steps allowed without numbers
// DONE: change text color
// DONE: change % of width for images accompanying text
// DONE: position step images
// DONE: layout boxes aren't allowed to overlap [might not be the most robust solution]
// DONE: abandon the idea of leaving grid cell's row and column sometimes blank?  (ie, fill them in all the time)
// DONE: match content order with layout order
// DONE: save images to AWS S3?
// DONE: sidebar with chapter groupings
// DONE: make sure sidebar text changes still work
// DONE: different sidebar icons for each spread type
// DONE: only retain 20 or so version histories in the menu (but allow permanent "checkpoints"? -> use Publish for major checkpoints; they're stored by Amazon)
// DONE: clicking on layout hint scrolls to corresponding content cell (also in Fixed layouts)
// DONE: delete hint when cell is deleted
// DONE: changing cell order doesn't seem to be working
// DONE: cell heading
// DONE: hints shouldn't jump over other hints when re-stacking (I don't think) and maybe they shouldn't restack at all, just get out of the way of the dragging cell? (so: one temporary "spacer" row?)
// DONE: invert color of step number blocks on dark backgrounds
// DONE: optimize the loading of the spread sidebar [as best I could think of; still very slow and repetitive]
// DONE: search in spread sidebar
// DONE: spread pane doesn't always load or refresh (spreadList.doRebuild() makes it show up, so it's probably a timing issue) [domReady issue, I think]
// DONE: callout lines
// DONE: callout line target selection dialog
// DONE: select a content cell selects / highlights the layout cell
// DONE: changing content id needs to also change layout id [ok, but you need to reload the spread for the new id's to be reflected everywhere]
// DONE: callouts per image
// DONE: size cell images (so they're not huge by default?)
// DONE: callout line pop-up dialog needs to size to fit image
// DONE: indicator for cells with callout lines
// DONE: fixed layout cells aren't staying put (SVG's don't have "width" so scaling issue)
// DONE: set callout line targets by clicking
// DONE: don't load all spreads at once (obviously!) – bottom TOC? horizontal swiping?
// DONE: throttle the menu loading (since it's so repetitive)
// DONE: selecting layout cells is no longer scrolling to selected cell
// DONE: make selecting content cell itself count as selecting that cell
// DONE: refactor callout lines so they can be shared by grid and fixed layouts
// DONE: for Fixed Layout steps, calculate the expanded/unexpanded positions and sizes on page load, not on click (or cache it at least)
// DONE: make gridder and fixer classes derive from same parent
// DONE: callout lines for callouts without .block (ie, .diamond or unnumbered steps) [falls back to .diamond, .textblock]
// DONE: resize when window resizes
// DONE: callout lines match text color
// DONE: added smooth scrolling for iPad (using css not iScroll because it didn't zoom-in-place well)
// DONE: UI DESIGN: leave pinch-zooming enabled?
// DONE: renamed "callout" boxes "sidebar"
// DONE: used iNobounce to eliminate iOS page bouncing
// DONE: animate callout lines as they scroll into view?
// DONE: highlight step number before callout line animates out
// DONE: open to random spread (for quality control review purposes)
// DONE: fixed layouts need to fit the pane (and centered)
// DONE: fixed layouts need next/prev buttons
// DONE: advance to next/prev spread by scrolling
// DONE: scroll and highlight TOC while scrolling through spreads
// DONE: keep track of current spread while scrolling (for waypoints) OR don't delete waypoints with each new spread
// DONE: TOC is hide-able
// DONE: sidebars not showing up in the right place
// DONE: sidebars need scrolling
// DONE: fixed layout sidebars aren't appearing in the correct place / z-order
// DONE: fixed layouts need to switch to black text for hover state
// DONE: optimize Fixed Layout positioning algorithm (it's way too slow) [eliminated in favor of just numbers]
// DONE: make fixed layout text areas scrollable (in case they can't fit on the screen)
// DONE: activating spreads
// DONE: fixed layout step navigation
// DONE: instead of a FixedLayout, have an AnnotatedImage cell type that can be dropped into a GridLayout (and get its data from steps)
// DONE: make a "fixed layout" widget that can be on a spread with other elements? [extracting fixed layout steps before or after spread]
// DONE: come up with navigation option (ie, arrows) for Fixed Layout
// DONE: remove extracted numbers from fixed layout navigation
// DONE: do extracted sidebars work?
// DONE: are fixed layout callout lines working?
// DONE: for Fixed Layouts, callout lines are only visible for the highlighted step?
// DONE: for Fixed Layouts, callout lines should not go in front of the current, expanded text area
// DONE: fixed layout steps should load in priority order (9_5)
// DONE: is non-blocking working on spreads 15_5 and 16_1?
// DONE: GridLayout.GetMaxYPosition shouldn't go through all rows
// DONE: nicer numbers and animations for fixed layouts (numbered and titled)
// NOPE: make Callout titles fit on one line (iPad) [not really necessary]
// DONE: come up with exterior framework / navigation / spread loading
// NOPE: Fixed layout steps don't account for "headings" when sizing [we're now using headings as selectable captions]
// DONE: show spread name in a fixed header
// DONE: extract images from Fixed Layouts
// DONE: Fixed Layout callout lines need to be drawn after the box height is established
// DONE: fixed layout textblocks scroll by page
// DONE: throttle reformatting due to window resize
// DONE: background color for fixed layouts
// DONE: fixed layouts don't automatically highlight step 1 if there's a "before" step
// DONE: big previous + next buttons on the sides of fixed layouts
// DONE: grid layouts have max-width
// DONE: style fixed layout navigation controls
// DONE: use nicer fonts everywhere
// DONE: Fixed Layouts need to use text color for unselected text (18_7)
// DONE: fixed layouts show text all the time
// DONE: dark fixed layouts need to invert blocks (20_6) [set text and background color]
// DONE: make an active style for the forward/next fixed layout buttons
// DONE: headers need to go back into fixed layout textblocks [10_2]
// DONE: "chapter" background color for layout (including margins)
// DONE: callout lines on dark should be white [20_4]
// DONE: space between paragraphs in textblocks [14_5]
// DONE: ability to add extra images to sidebars
// DONE: interactive slide-over
// DONE: interactive in-place
// DONE: chapter and part intros
// DONE: put chapter intros into the chapter header TOC and make them clickable
// DONE: find place for Part text
// DONE: make Part chapter listings clickable
